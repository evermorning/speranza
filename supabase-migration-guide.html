<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Supabase ê²°ì œ í…Œì´ë¸” ë§ˆì´ê·¸ë ˆì´ì…˜</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .container {
            background: #2a2a2a;
            border-radius: 8px;
            padding: 30px;
            margin-bottom: 20px;
        }
        h1 {
            color: #3ecf8e;
            border-bottom: 2px solid #3ecf8e;
            padding-bottom: 10px;
        }
        h2 {
            color: #48b9ff;
            margin-top: 30px;
        }
        .step {
            background: #333;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #3ecf8e;
            border-radius: 4px;
        }
        .sql-code {
            background: #1a1a1a;
            border: 1px solid #444;
            border-radius: 4px;
            padding: 20px;
            overflow-x: auto;
            position: relative;
        }
        .sql-code pre {
            margin: 0;
            color: #e0e0e0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
        }
        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #3ecf8e;
            color: #000;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        .copy-btn:hover {
            background: #2eaf7e;
        }
        .success {
            background: #1e4d2b;
            color: #3ecf8e;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .warning {
            background: #4d3a1e;
            color: #ffb84d;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        a {
            color: #48b9ff;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
        .table-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .table-item {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 4px;
            border: 1px solid #444;
        }
        .table-name {
            font-weight: bold;
            color: #3ecf8e;
            font-size: 16px;
        }
        .table-desc {
            color: #aaa;
            font-size: 13px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ Supabase ê²°ì œ í…Œì´ë¸” ë§ˆì´ê·¸ë ˆì´ì…˜</h1>
        
        <div class="warning">
            âš ï¸ <strong>ì¤‘ìš”:</strong> ì´ ë§ˆì´ê·¸ë ˆì´ì…˜ì€ 2ë‹¨ê³„ë¡œ ë‚˜ëˆ„ì–´ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤!<br>
            1ë‹¨ê³„: users í…Œì´ë¸” ìƒì„±<br>
            2ë‹¨ê³„: ê²°ì œ ê´€ë ¨ í…Œì´ë¸” ìƒì„± (users í…Œì´ë¸” ì°¸ì¡°)
        </div>

        <h2>ğŸ“‹ 1ë‹¨ê³„: users í…Œì´ë¸” ìƒì„±</h2>
        
        <div class="step">
            <strong>1-1:</strong> Supabase Dashboard ì ‘ì†<br>
            ğŸ‘‰ <a href="https://app.supabase.com/project/zxodavgsdtpnbmqojtnh/sql/new" target="_blank">
                SQL Editor ë°”ë¡œê°€ê¸°
            </a>
        </div>

        <div class="step">
            <strong>1-2:</strong> ì•„ë˜ <strong>"SQL 1ë‹¨ê³„"</strong>ë¥¼ ë³µì‚¬
        </div>

        <div class="step">
            <strong>1-3:</strong> SQL Editorì— ë¶™ì—¬ë„£ê³  <strong>Run</strong> í´ë¦­
        </div>

        <div class="step">
            <strong>1-4:</strong> ì„±ê³µ ë©”ì‹œì§€ í™•ì¸ í›„ <strong>"SQL 2ë‹¨ê³„"</strong> ì‹¤í–‰
        </div>

        <h2>ğŸ“Š ìƒì„±ë˜ëŠ” í…Œì´ë¸” (6ê°œ)</h2>
        
        <div class="table-list">
            <div class="table-item">
                <div class="table-name">ğŸ’³ payments</div>
                <div class="table-desc">ëª¨ë“  ê²°ì œ ë‚´ì—­ (ë‹¨ê±´ + ì •ê¸°)</div>
            </div>
            <div class="table-item">
                <div class="table-name">ğŸ”‘ billing_keys</div>
                <div class="table-desc">ì •ê¸°ê²°ì œ ë¹Œë§í‚¤</div>
            </div>
            <div class="table-item">
                <div class="table-name">ğŸ“¦ subscription_plans</div>
                <div class="table-desc">êµ¬ë… í”Œëœ (ë¬´ë£Œ/ë² ì´ì§/í”„ë¡œ)</div>
            </div>
            <div class="table-item">
                <div class="table-name">ğŸ‘¤ user_subscriptions</div>
                <div class="table-desc">ì‚¬ìš©ì êµ¬ë… ì •ë³´</div>
            </div>
            <div class="table-item">
                <div class="table-name">ğŸ’° user_payment_info</div>
                <div class="table-desc">ì‚¬ìš©ì ê²°ì œ ì •ë³´</div>
            </div>
            <div class="table-item">
                <div class="table-name">â†©ï¸ refunds</div>
                <div class="table-desc">í™˜ë¶ˆ ë‚´ì—­</div>
            </div>
        </div>

        <h2>ğŸ“ SQL 1ë‹¨ê³„: users í…Œì´ë¸”</h2>
        
        <div class="sql-code">
            <button class="copy-btn" onclick="copySQL1()">ğŸ“‹ Copy SQL 1ë‹¨ê³„</button>
            <pre id="sqlCode1">-- ========================================
-- ì‚¬ìš©ì í…Œì´ë¸” ìƒì„± (ë¨¼ì € ì‹¤í–‰!)
-- ========================================

CREATE TABLE IF NOT EXISTS users (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  email VARCHAR(255) NOT NULL UNIQUE,
  name VARCHAR(100),
  password VARCHAR(255) NOT NULL,
  provider VARCHAR(50) DEFAULT 'credentials',
  image TEXT,
  email_verified TIMESTAMPTZ,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

CREATE INDEX IF NOT EXISTS idx_users_email ON users(email);
CREATE INDEX IF NOT EXISTS idx_users_created_at ON users(created_at);

CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
$$ language 'plpgsql';

DROP TRIGGER IF EXISTS update_users_updated_at ON users;
CREATE TRIGGER update_users_updated_at
    BEFORE UPDATE ON users
    FOR EACH ROW
    EXECUTE FUNCTION update_updated_at_column();</pre>
        </div>

        <h2>ğŸ“ SQL 2ë‹¨ê³„: ê²°ì œ í…Œì´ë¸”</h2>
        
        <div class="sql-code">
            <button class="copy-btn" onclick="copySQL2()">ğŸ“‹ Copy SQL 2ë‹¨ê³„</button>
            <pre id="sqlCode2">-- ========================================
-- ê²°ì œ ê´€ë ¨ í…Œì´ë¸” ìƒì„± (ë‹¨ê±´ê²°ì œ + ì •ê¸°ê²°ì œ)
-- ========================================

-- 1ï¸âƒ£ êµ¬ë… í”Œëœ í…Œì´ë¸”
CREATE TABLE IF NOT EXISTS subscription_plans (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(100) NOT NULL UNIQUE,
  display_name VARCHAR(200) NOT NULL,
  description TEXT,
  price INTEGER NOT NULL DEFAULT 0,
  currency VARCHAR(3) NOT NULL DEFAULT 'KRW',
  interval VARCHAR(20) NOT NULL DEFAULT 'month',
  interval_count INTEGER NOT NULL DEFAULT 1,
  features JSONB NOT NULL DEFAULT '{}',
  is_active BOOLEAN NOT NULL DEFAULT true,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- 2ï¸âƒ£ ì‚¬ìš©ì êµ¬ë… í…Œì´ë¸” (ì •ê¸°ê²°ì œ)
CREATE TABLE IF NOT EXISTS user_subscriptions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  plan_id UUID NOT NULL REFERENCES subscription_plans(id) ON DELETE RESTRICT,
  billing_key_id UUID,
  status VARCHAR(20) NOT NULL DEFAULT 'active',
  started_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  expires_at TIMESTAMPTZ,
  cancelled_at TIMESTAMPTZ,
  next_billing_date TIMESTAMPTZ,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- 3ï¸âƒ£ ê²°ì œ í…Œì´ë¸” (ë‹¨ê±´ê²°ì œ + ì •ê¸°ê²°ì œ ëª¨ë‘ ì €ì¥)
CREATE TABLE IF NOT EXISTS payments (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  subscription_id UUID REFERENCES user_subscriptions(id) ON DELETE SET NULL,
  payment_key VARCHAR(200) NOT NULL UNIQUE,
  order_id VARCHAR(200) NOT NULL UNIQUE,
  order_name VARCHAR(200) NOT NULL,
  amount INTEGER NOT NULL,
  currency VARCHAR(3) NOT NULL DEFAULT 'KRW',
  payment_method VARCHAR(50),
  status VARCHAR(20) NOT NULL DEFAULT 'pending',
  payment_type VARCHAR(20) NOT NULL DEFAULT 'one_time',
  approved_at TIMESTAMPTZ,
  canceled_at TIMESTAMPTZ,
  failed_at TIMESTAMPTZ,
  receipt_url TEXT,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- 4ï¸âƒ£ ë¹Œë§í‚¤ í…Œì´ë¸” (ì •ê¸°ê²°ì œìš©)
CREATE TABLE IF NOT EXISTS billing_keys (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
  billing_key VARCHAR(200) NOT NULL UNIQUE,
  customer_key VARCHAR(200) NOT NULL,
  method VARCHAR(50),
  card_info JSONB,
  status VARCHAR(20) NOT NULL DEFAULT 'active',
  expires_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- 5ï¸âƒ£ ì‚¬ìš©ì ê²°ì œ ì •ë³´ í…Œì´ë¸”
CREATE TABLE IF NOT EXISTS user_payment_info (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  user_id UUID NOT NULL UNIQUE REFERENCES users(id) ON DELETE CASCADE,
  customer_key VARCHAR(200) NOT NULL UNIQUE,
  default_payment_method VARCHAR(50),
  billing_address JSONB,
  tax_id VARCHAR(50),
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- 6ï¸âƒ£ í™˜ë¶ˆ í…Œì´ë¸”
CREATE TABLE IF NOT EXISTS refunds (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  payment_id UUID NOT NULL REFERENCES payments(id) ON DELETE CASCADE,
  refund_key VARCHAR(200) NOT NULL UNIQUE,
  amount INTEGER NOT NULL,
  reason TEXT,
  status VARCHAR(20) NOT NULL DEFAULT 'pending',
  processed_at TIMESTAMPTZ,
  created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),
  updated_at TIMESTAMPTZ NOT NULL DEFAULT NOW()
);

-- ğŸ“Š ì¸ë±ìŠ¤ ìƒì„± (ì„±ëŠ¥ ìµœì í™”)
CREATE INDEX IF NOT EXISTS idx_user_subscriptions_user_id ON user_subscriptions(user_id);
CREATE INDEX IF NOT EXISTS idx_user_subscriptions_status ON user_subscriptions(status);
CREATE INDEX IF NOT EXISTS idx_payments_user_id ON payments(user_id);
CREATE INDEX IF NOT EXISTS idx_payments_payment_key ON payments(payment_key);
CREATE INDEX IF NOT EXISTS idx_payments_order_id ON payments(order_id);
CREATE INDEX IF NOT EXISTS idx_payments_status ON payments(status);
CREATE INDEX IF NOT EXISTS idx_billing_keys_user_id ON billing_keys(user_id);
CREATE INDEX IF NOT EXISTS idx_billing_keys_billing_key ON billing_keys(billing_key);
CREATE INDEX IF NOT EXISTS idx_billing_keys_status ON billing_keys(status);
CREATE INDEX IF NOT EXISTS idx_user_payment_info_user_id ON user_payment_info(user_id);
CREATE INDEX IF NOT EXISTS idx_refunds_payment_id ON refunds(payment_id);

-- ğŸ ê¸°ë³¸ í”Œëœ ë°ì´í„° ì‚½ì…
INSERT INTO subscription_plans (name, display_name, description, price, features)
VALUES (
  'free',
  'ë¬´ë£Œ í”Œëœ',
  'ê¸°ë³¸ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë¬´ë£Œ í”Œëœì…ë‹ˆë‹¤.',
  0,
  '{"limits": {"daily_searches": 10, "trend_reports": 5}}'::JSONB
) ON CONFLICT (name) DO NOTHING;

INSERT INTO subscription_plans (name, display_name, description, price, features)
VALUES (
  'basic',
  'ë² ì´ì§ í”Œëœ',
  'ë” ë§ì€ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë² ì´ì§ í”Œëœì…ë‹ˆë‹¤.',
  9900,
  '{"limits": {"daily_searches": 100, "trend_reports": 50}}'::JSONB
) ON CONFLICT (name) DO NOTHING;

INSERT INTO subscription_plans (name, display_name, description, price, features)
VALUES (
  'pro',
  'í”„ë¡œ í”Œëœ',
  'ë¬´ì œí•œìœ¼ë¡œ ëª¨ë“  ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í”„ë¡œ í”Œëœì…ë‹ˆë‹¤.',
  29900,
  '{"limits": {"daily_searches": -1, "trend_reports": -1}}'::JSONB
) ON CONFLICT (name) DO NOTHING;</pre>
        </div>

        <div class="success">
            âœ… <strong>ì„±ê³µ í™•ì¸:</strong> Table Editorì—ì„œ 6ê°œ í…Œì´ë¸”ê³¼ 3ê°œ í”Œëœ ë°ì´í„°ë¥¼ í™•ì¸í•˜ì„¸ìš”!
        </div>

        <h2>ğŸ”— ë¹ ë¥¸ ë§í¬</h2>
        <div class="step">
            <a href="https://app.supabase.com/project/zxodavgsdtpnbmqojtnh/editor" target="_blank">
                ğŸ—„ï¸ SQL Editor ë°”ë¡œê°€ê¸°
            </a>
        </div>
        <div class="step">
            <a href="https://app.supabase.com/project/zxodavgsdtpnbmqojtnh/editor" target="_blank">
                ğŸ“Š Table Editor ë°”ë¡œê°€ê¸°
            </a>
        </div>
    </div>

    <script>
        function copySQL1() {
            const sqlCode = document.getElementById('sqlCode1').textContent;
            navigator.clipboard.writeText(sqlCode).then(() => {
                alert('âœ… SQL 1ë‹¨ê³„ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nSupabase SQL Editorì— ë¶™ì—¬ë„£ê³  Runì„ í´ë¦­í•˜ì„¸ìš”.');
            });
        }
        
        function copySQL2() {
            const sqlCode = document.getElementById('sqlCode2').textContent;
            navigator.clipboard.writeText(sqlCode).then(() => {
                alert('âœ… SQL 2ë‹¨ê³„ê°€ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!\n\nSQL 1ë‹¨ê³„ ì‹¤í–‰ í›„ ì´ SQLì„ ë¶™ì—¬ë„£ê³  Runì„ í´ë¦­í•˜ì„¸ìš”.');
            });
        }
    </script>
</body>
</html>
